<?php

require __DIR__. '/vendor/autoload.php';

use fkooman\SeCookie\Session;

$session = new fkooman\SeCookie\Session(null,
 fkooman\SeCookie\CookieOptions::init()->withSameSiteNone()
);
$session->start();
if($session->get('LoggedIn') !== "True")
{
	header('Location: index.html');
}

?>

<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Home Page</title>
		<link href="style.css" rel="stylesheet" type="text/css">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css">
	</head>
	<body class="loggedin">
		<nav class="navtop">
			<div>
				<h1>Website Title</h1>
				<a href="profile.php"><i class="fas fa-user-circle"></i>Profile</a>
				<a href="logout.php"><i class="fas fa-sign-out-alt"></i>Logout</a>
			</div>
		</nav>
		<div class="content">
			<h2>Profile</h2>
            <?php
                if(array_key_exists('button1', $_POST))
                {
                    button1($session);
                }
                else if(array_key_exists('button2', $_POST))
                {
                    button2($session);
                }
                function button1($session)
                {
                    if($session->get('Admin') === "False")
                    {
                        $session->set('Admin' , 'True');
                        $session->regenerate();
                        echo "You now have admin rights";
                    }
                    else
                    {
                        echo "You already have admin rights!";
                    }
                }
                function button2($session)
                {
                    if($session->get('Admin') === "True")
                    {
                        $session->set('Admin' , 'False');
                        $session->regenerate();
                        echo "You removed your admin rights";
                    }
                    else
                    {
                        echo "Admin rights were already removed!";
                    }
                }
                
            ?>
            
            <form method="post">
                <input type="submit" name="button1"
                    class="button" value="Become admin" />

                <input type="submit" name="button2"
                    class="button" value="Become user" />
            </form><br>
            <img src="hond2.png" alt="hond">
            <form method="POST">
                <input name="delete" type="submit" value="Delete now!">
            </form>
            <?php
                if($session->get('Admin') === "True")
                {
                    if(isset($_POST['delete']))
                    {
                        $im = imagecreatetruecolor(55, 30);
                        $red = imagecolorallocate($im, 255, 0, 0);
                        $black = imagecolorallocate($im, 0, 0, 0);

                        imagecolortransparent($im, $black);
                        imagefilledrectangle($im, 4, 4, 50, 25, $red);
                        imagepng($im, './hond2.png');
                        imagedestroy($im);
                    }
                } 
            ?>
        </div>
	</body>
</html>
